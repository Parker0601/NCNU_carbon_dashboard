{{#> 
    layouts/main 
    title="碳信用交易模組" 
    pagename="boss_carbon_trading"
    heading="碳信用交易模組"
    category_1="老闆專區"
    pagedescription="即時監控碳信用資產與市場狀況，快速做出交易決策"
}}

{{#*inline "head-block"}}
<link rel="stylesheet" media="screen, print" href="css/statistics/chartjs/chartjs.css">
<link rel="stylesheet" media="screen, print" href="css/vendors.bundle.css"/>
<link rel="stylesheet" media="screen, print" href="css/app.bundle.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-…" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
  .dashboard-section { margin-bottom: 2rem; }
  .trading-chart { height: 320px; width: 100%; }
  .order-table th, .order-table td { vertical-align: middle; }
</style>
{{/inline}}

{{#*inline "content-block"}}
  <!-- 第一行：碳價格走勢 (8 cols) + 上單操作 (4 cols) -->
  <div class="row dashboard-section">
    <!-- 碳價格走勢 -->
    <div class="col-lg-8 mb-4">
      <div class="panel h-100">
        <div class="panel-hdr"><h2>碳價格走勢</h2></div>
        <div class="panel-container show p-3">
          <canvas id="carbonPriceChart" class="trading-chart"></canvas>
        </div>
      </div>
    </div>
    <!-- 上單操作 -->
    <div class="col-lg-4 mb-4">
      <div class="panel h-100">
        <div class="panel-hdr"><h2>上單操作</h2></div>
        <div class="panel-container show p-3">
          <form id="orderForm">
            <div class="form-group">
              <label>碳信用名稱</label>
              <input type="text" class="form-control" name="creditName" required>
            </div>
            <div class="form-group">
              <label>數量</label>
              <input type="number" class="form-control" name="quantity" min="1" required>
            </div>
            <div class="form-group">
              <label>價格 (NT$)</label>
              <input type="number" class="form-control" name="price" min="1" required>
            </div>
            <div class="form-group">
              <label>操作類型</label>
              <select class="form-control" name="orderType">
                <option value="sell">賣出</option>
                <option value="buy">買入</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary btn-block">送出訂單</button>
          </form>
          <div class="mt-3 d-flex justify-content-between">
            <button class="btn btn-sm btn-outline-success">下載銷售總結報告</button>
            <button class="btn btn-sm btn-outline-info">下載貿易成果報告</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 第二行：訂單持倉列表 (4 cols) + 歷史成交紀錄 (8 cols) -->
  <div class="row dashboard-section">
    <!-- 訂單持倉列表 -->
    <div class="col-lg-4 mb-4">
      <div class="panel h-100">
        <div class="panel-hdr"><h2>訂單持倉列表</h2></div>
        <div class="panel-container show p-0">
          <table class="table table-striped table-bordered order-table mb-0">
            <thead>
              <tr>
                <th>
                  <div class="d-flex align-items-center">
                    碳批次 <i class="fa fa-chevron-down ml-1"></i>
                  </div>
                </th>
                <th class="text-right">
                  <div class="d-flex align-items-center justify-content-end">
                    數量 <i class="fa fa-chevron-down ml-1"></i>
                  </div>
                </th>
                <th class="text-right">
                  <div class="d-flex align-items-center justify-content-end">
                    漲跌% <i class="fa fa-chevron-down ml-1"></i>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div>
                      <div><strong>TCX-2024-01</strong></div>
                      <small class="text-muted">公司A</small>
                    </div>
                  </div>
                </td>
                <td class="text-right">1,000</td>
                <td class="text-right text-success">+8.25%</td>
              </tr>
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div>
                      <div><strong>TCX-2024-02</strong></div>
                      <small class="text-muted">公司B</small>
                    </div>
                  </div>
                </td>
                <td class="text-right">500</td>
                <td class="text-right text-warning">−3.10%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 歷史成交紀錄 -->
    <div class="col-lg-8 mb-4">
      <div class="panel h-100">
        <div class="panel-hdr"><h2>歷史成交紀錄</h2></div>
        <div class="panel-container show p-0">
          <div class="table-responsive">
            <table class="table trading-history-table mb-0">
              <thead>
                <tr>
                  <th>日期 <i class="fa fa-chevron-down ml-1"></i></th>
                  <th>成交股數 <i class="fa fa-chevron-down ml-1"></i></th>
                  <th>成交金額 <i class="fa fa-chevron-down ml-1"></i></th>
                  <th>開盤價 <i class="fa fa-chevron-down ml-1"></i></th>
                  <th>最高價 <i class="fa fa-chevron-down ml-1"></i></th>
                  <th>最低價 <i class="fa fa-chevron-down ml-1"></i></th>
                  <th>收盤價 <i class="fa fa-chevron-down ml-1"></i></th>
                  <th>漲跌價差 <i class="fa fa-chevron-down ml-1"></i></th>
                  <th>成交筆數 <i class="fa fa-chevron-down ml-1"></i></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>114/05/02</td>
                  <td>48,129,292</td>
                  <td>45,206,565,214</td>
                  <td>938.00</td>
                  <td>950.00</td>
                  <td>932.00</td>
                  <td>950.00</td>
                  <td class="text-success">+42.00</td>
                  <td>99,509</td>
                </tr>
                <!-- 更多歷史紀錄... -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
{{/inline}}

{{#*inline "scripts-block"}}
<script src="/js/vendors.bundle.js"></script>
<script src="/js/app.bundle.js"></script>
<script src="js/statistics/chartjs/chartjs.bundle.js"></script>
<script>
$(document).ready(function() {
  // 碳價格走勢圖
  var ctx = document.getElementById('carbonPriceChart').getContext('2d');
  var carbonPriceChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['2024-05-01', '2024-05-08', '2024-05-15', '2024-05-22', '2024-05-29', '2024-06-05'],
      datasets: [{
        label: '碳價格 (NT$)',
        data: [1100, 1150, 1200, 1180, 1220, 1250],
        borderColor: '#2196f3',
        backgroundColor: 'rgba(33,150,243,0.1)',
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });

  // 權限控制（僅顯示有權限者操作按鈕）
  // 這裡可根據API回傳的權限動態顯示/隱藏按鈕

  // 上單表單送出（預留API串接）
  $('#orderForm').on('submit', function(e) {
    e.preventDefault();
    // 這裡可串接API送出訂單
    alert('訂單已送出（僅示意，請串接API）');
  });
});
</script>
{{/inline}}

{{/layouts/main}} 